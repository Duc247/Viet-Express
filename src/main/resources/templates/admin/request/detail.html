<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{admin/layout-admin}">

<head>
    <title>Chi tiết Đơn hàng</title>
</head>

<body>
    <div layout:fragment="content">
        <div class="d-flex justify-content-between align-items-center pb-2 mb-3 border-bottom">
            <h1 class="h2"><i class="fas fa-file-invoice me-2"></i>Chi tiết Đơn hàng</h1>
            <div>
                <a th:href="@{/admin/request/{id}/edit(id=${customerRequest.id})}" class="btn btn-primary">
                    <i class="fas fa-edit me-1"></i> Sửa
                </a>
                <a href="/admin/request" class="btn btn-secondary"><i class="fas fa-arrow-left me-1"></i> Quay lại</a>
            </div>
        </div>

        <div class="row">
            <div class="col-md-8">
                <!-- Thông tin đơn hàng -->
                <div class="card mb-4">
                    <div class="card-header"><i class="fas fa-info-circle me-2"></i>Thông tin đơn hàng</div>
                    <div class="card-body">
                        <table class="table table-borderless">
                            <tr>
                                <th width="30%">Mã đơn:</th>
                                <td><code th:text="${customerRequest.requestCode}"></code></td>
                            </tr>
                            <tr>
                                <th>Trạng thái:</th>
                                <td>
                                    <span class="badge bg-warning" th:if="${customerRequest.status == 'PENDING'}">Chờ
                                        xác nhận</span>
                                    <span class="badge bg-info"
                                        th:if="${customerRequest.status == 'RECEIVER_CONFIRMED'}">Receiver đã xác
                                        nhận</span>
                                    <span class="badge bg-success" th:if="${customerRequest.status == 'CONFIRMED'}">Đã
                                        duyệt</span>
                                    <span class="badge bg-primary"
                                        th:if="${customerRequest.status == 'PICKUP_ASSIGNED'}">Đã gán lấy hàng</span>
                                    <span class="badge bg-info" th:if="${customerRequest.status == 'PICKED_UP'}">Đã lấy
                                        hàng</span>
                                    <span class="badge bg-secondary"
                                        th:if="${customerRequest.status == 'IN_WAREHOUSE'}">Trong kho</span>
                                    <span class="badge bg-primary"
                                        th:if="${customerRequest.status == 'IN_TRANSIT'}">Đang vận chuyển</span>
                                    <span class="badge bg-info"
                                        th:if="${customerRequest.status == 'OUT_FOR_DELIVERY'}">Đang giao</span>
                                    <span class="badge bg-success" th:if="${customerRequest.status == 'DELIVERED'}">Đã
                                        giao</span>
                                    <span class="badge bg-danger" th:if="${customerRequest.status == 'FAILED'}">Thất
                                        bại</span>
                                    <span class="badge bg-warning" th:if="${customerRequest.status == 'RETURNED'}">Hoàn
                                        trả</span>
                                    <span class="badge bg-dark" th:if="${customerRequest.status == 'CANCELLED'}">Đã
                                        hủy</span>
                                </td>
                            </tr>
                            <tr>
                                <th>Mô tả:</th>
                                <td th:text="${customerRequest.parcelDescription ?: '-'}"></td>
                            </tr>
                            <tr>
                                <th>Ghi chú:</th>
                                <td th:text="${customerRequest.note ?: '-'}"></td>
                            </tr>
                            <tr>
                                <th>Khoảng cách:</th>
                                <td
                                    th:text="${customerRequest.distanceKm != null ? customerRequest.distanceKm + ' km' : '-'}">
                                </td>
                            </tr>
                            <tr>
                                <th>Phí vận chuyển:</th>
                                <td><strong class="text-success"
                                        th:text="${customerRequest.shippingFee != null ? #numbers.formatDecimal(customerRequest.shippingFee, 0, 'COMMA', 0, 'NONE') + ' đ' : '-'}"></strong>
                                </td>
                            </tr>
                            <tr>
                                <th>COD:</th>
                                <td><strong class="text-danger"
                                        th:text="${customerRequest.codAmount != null ? #numbers.formatDecimal(customerRequest.codAmount, 0, 'COMMA', 0, 'NONE') + ' đ' : '0 đ'}"></strong>
                                </td>
                            </tr>
                            <tr>
                                <th>Ngày tạo:</th>
                                <td
                                    th:text="${customerRequest.createdAt != null ? #temporals.format(customerRequest.createdAt, 'dd/MM/yyyy HH:mm') : '-'}">
                                </td>
                            </tr>
                            <tr>
                                <th>Giao dự kiến:</th>
                                <td
                                    th:text="${customerRequest.estimatedDeliveryTime != null ? #temporals.format(customerRequest.estimatedDeliveryTime, 'dd/MM/yyyy HH:mm') : '-'}">
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>

                <!-- Người gửi -->
                <div class="card mb-4">
                    <div class="card-header"><i class="fas fa-user me-2"></i>Người gửi</div>
                    <div class="card-body">
                        <table class="table table-borderless">
                            <tr>
                                <th width="30%">Họ tên:</th>
                                <td th:text="${customerRequest.senderName ?: '-'}"></td>
                            </tr>
                            <tr>
                                <th>Địa chỉ:</th>
                                <td th:text="${customerRequest.senderLocationName ?: '-'}"></td>
                            </tr>
                        </table>
                    </div>
                </div>

                <!-- Người nhận -->
                <div class="card mb-4">
                    <div class="card-header"><i class="fas fa-user-check me-2"></i>Người nhận</div>
                    <div class="card-body">
                        <table class="table table-borderless">
                            <tr>
                                <th width="30%">Họ tên:</th>
                                <td th:text="${customerRequest.receiverName ?: '-'}"></td>
                            </tr>
                            <tr>
                                <th>Địa chỉ:</th>
                                <td th:text="${customerRequest.receiverLocationName ?: '-'}"></td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <!-- Loại dịch vụ -->
                <div class="card mb-4">
                    <div class="card-header"><i class="fas fa-truck me-2"></i>Loại dịch vụ</div>
                    <div class="card-body">
                        <p th:text="${customerRequest.serviceTypeName ?: 'Chưa chọn'}"></p>
                    </div>
                </div>

                <!-- Staff xử lý -->
                <div class="card mb-4">
                    <div class="card-header"><i class="fas fa-user-cog me-2"></i>Staff xử lý</div>
                    <div class="card-body">
                        <p th:if="${customerRequest.assignedStaffId != null}"
                            th:text="${customerRequest.assignedStaffName}"></p>
                        <p th:unless="${customerRequest.assignedStaffId != null}" class="text-muted">Chưa gán</p>
                        <small th:if="${customerRequest.assignedAt != null}" class="text-muted"
                            th:text="'Gán lúc: ' + ${#temporals.format(customerRequest.assignedAt, 'dd/MM/yyyy HH:mm')}"></small>
                    </div>
                </div>

                <!-- Hành động -->
                <div class="card">
                    <div class="card-header"><i class="fas fa-cogs me-2"></i>Hành động</div>
                    <div class="card-body d-grid gap-2">
                        <a th:href="@{/admin/request/{id}/edit(id=${customerRequest.id})}" class="btn btn-primary">
                            <i class="fas fa-edit me-1"></i> Chỉnh sửa
                        </a>
                        <button type="button" class="btn btn-danger" data-bs-toggle="modal"
                            data-bs-target="#deleteModal">
                            <i class="fas fa-trash me-1"></i> Xóa đơn hàng
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Modal -->
    <div class="modal fade" id="deleteModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Xác nhận xóa</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    Bạn có chắc chắn muốn xóa đơn hàng <code th:text="${customerRequest.requestCode}"></code>?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                    <form th:action="@{/admin/request/{id}/delete(id=${customerRequest.id})}" method="post"
                        style="display:inline;">
                        <button type="submit" class="btn btn-danger">Xóa</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</body>

</html>