<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{manager/layout-manager}">

<head>
    <title>Chi ti·∫øt y√™u c·∫ßu - Manager</title>
</head>

<body>

    <div layout:fragment="content">

        <!-- Header -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h2 class="h4 fw-bold mb-1">
                    <i class="fas fa-file-alt me-2"></i>Chi ti·∫øt y√™u c·∫ßu
                </h2>
                <span class="badge bg-secondary fs-6" th:text="${order.requestCode}">REQ-XXX</span>
            </div>
            <a href="/manager/requests" class="btn btn-outline-secondary">
                <i class="fas fa-arrow-left me-1"></i>Quay l·∫°i
            </a>
        </div>

        <!-- Alert Messages -->
        <div th:if="${successMessage}" class="alert alert-success alert-dismissible fade show">
            <i class="fas fa-check-circle me-2"></i><span th:text="${successMessage}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        <div th:if="${errorMessage}" class="alert alert-danger alert-dismissible fade show">
            <i class="fas fa-exclamation-circle me-2"></i><span th:text="${errorMessage}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>

        <div class="row">
            <!-- C·ªôt tr√°i: Th√¥ng tin ƒë∆°n -->
            <div class="col-lg-8">
                <!-- Card: Th√¥ng tin chung -->
                <div class="card shadow-sm mb-4">
                    <div class="card-header bg-white py-3">
                        <h6 class="mb-0 fw-bold text-primary"><i class="fas fa-info-circle me-2"></i>Th√¥ng tin ƒë∆°n h√†ng
                        </h6>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <strong>Tr·∫°ng th√°i:</strong>
                                <span class="badge bg-secondary ms-2" th:if="${order.status.name() == 'PENDING'}">Ch·ªù
                                    ng∆∞·ªùi nh·∫≠n XN</span>
                                <span class="badge bg-info ms-2" th:if="${order.status.name() == 'RECEIVER_CONFIRMED'}">
                                    <i class="fas fa-check me-1"></i>S·∫µn s√†ng ch·ªët ƒë∆°n
                                </span>
                                <span class="badge bg-success ms-2" th:if="${order.status.name() == 'CONFIRMED'}">ƒê√£
                                    ch·ªët ƒë∆°n</span>
                                <span class="badge bg-primary ms-2" th:if="${order.status.name() == 'IN_TRANSIT'}">ƒêang
                                    v·∫≠n chuy·ªÉn</span>
                                <span class="badge bg-success ms-2" th:if="${order.status.name() == 'DELIVERED'}">ƒê√£
                                    giao</span>
                            </div>
                            <div class="col-md-6 mb-3">
                                <strong>Ng√†y t·∫°o:</strong>
                                <span
                                    th:text="${#temporals.format(order.createdAt, 'dd/MM/yyyy HH:mm')}">01/01/2025</span>
                            </div>
                        </div>
                        <hr>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <strong><i class="fas fa-user me-1 text-success"></i>Ng∆∞·ªùi g·ª≠i:</strong>
                                <p class="mb-0 ms-3" th:text="${order.sender?.name ?: 'N/A'}">T√™n</p>
                                <small class="text-muted ms-3" th:text="${order.sender?.phone}">SƒêT</small>
                            </div>
                            <div class="col-md-6 mb-3">
                                <strong><i class="fas fa-user me-1 text-primary"></i>Ng∆∞·ªùi nh·∫≠n:</strong>
                                <p class="mb-0 ms-3" th:text="${order.receiver?.name ?: 'Ch∆∞a c√≥'}">T√™n</p>
                                <small class="text-muted ms-3" th:text="${order.receiver?.phone}">SƒêT</small>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <strong><i class="fas fa-map-marker-alt me-1 text-success"></i>ƒêi·ªÉm l·∫•y:</strong>
                                <p class="mb-0 ms-3 small" th:text="${order.senderLocation?.name}">ƒê·ªãa ch·ªâ</p>
                                <small class="text-muted ms-3" th:text="${order.senderLocation?.addressText}"></small>
                            </div>
                            <div class="col-md-6 mb-3">
                                <strong><i class="fas fa-map-marker-alt me-1 text-danger"></i>ƒêi·ªÉm giao:</strong>
                                <p class="mb-0 ms-3 small" th:text="${order.receiverLocation?.name}">ƒê·ªãa ch·ªâ</p>
                                <small class="text-muted ms-3" th:text="${order.receiverLocation?.addressText}"></small>
                            </div>
                        </div>
                        <div class="d-flex gap-2 mb-3">
                            <button class="btn btn-sm btn-outline-secondary" data-bs-toggle="modal"
                                data-bs-target="#updateLocationModal">
                                <i class="fas fa-edit me-1"></i>Thay ƒë·ªïi ƒë·ªãa ƒëi·ªÉm
                            </button>
                            <button class="btn btn-sm btn-outline-primary" data-bs-toggle="modal"
                                data-bs-target="#createLocationModal">
                                <i class="fas fa-plus me-1"></i>T·∫°o ƒë·ªãa ƒëi·ªÉm m·ªõi
                            </button>
                        </div>
                        <hr>
                        <div class="row">
                            <div class="col-md-4 mb-2">
                                <strong>M√¥ t·∫£ h√†ng:</strong>
                                <p class="mb-0" th:text="${order.parcelDescription ?: '-'}">M√¥ t·∫£</p>
                            </div>
                            <div class="col-md-4 mb-2">
                                <strong>Ph√≠ ship:</strong>
                                <span class="text-primary fw-bold"
                                    th:text="${#numbers.formatDecimal(order.shippingFee ?: 0, 0, 'COMMA', 0, 'POINT')}">0</span>‚Ç´
                            </div>
                            <div class="col-md-4 mb-2">
                                <strong>Thu h·ªô (COD):</strong>
                                <span class="text-danger fw-bold"
                                    th:text="${#numbers.formatDecimal(order.codAmount ?: 0, 0, 'COMMA', 0, 'POINT')}">0</span>‚Ç´
                            </div>
                        </div>
                    </div>
                    <!-- Action buttons -->
                    <div class="card-footer bg-light" th:if="${order.status.name() == 'PENDING'}">
                        <form th:action="@{/manager/requests/{id}/confirm(id=${order.id})}" method="post"
                            class="d-inline">
                            <button type="submit" class="btn btn-success"
                                onclick="return confirm('B·∫°n c√≥ ch·∫Øc mu·ªën ch·ªët ƒë∆°n n√†y?');">
                                <i class="fas fa-check me-1"></i>Ch·ªët ƒë∆°n
                            </button>
                        </form>
                    </div>
                </div>

                <!-- Card: Giao vi·ªác cho Staff -->
                <div class="card shadow-sm mb-4 border-warning">
                    <div class="card-header bg-warning bg-opacity-25 py-3">
                        <h6 class="mb-0 fw-bold text-dark">
                            <i class="fas fa-user-cog me-2"></i>Giao vi·ªác t·∫°o ki·ªán h√†ng
                        </h6>
                    </div>
                    <div class="card-body">
                        <!-- Hi·ªÉn th·ªã staff ƒë√£ ƒë∆∞·ª£c giao (n·∫øu c√≥) -->
                        <div th:if="${order.assignedStaff != null}" class="alert alert-success mb-3">
                            <i class="fas fa-check-circle me-2"></i>
                            <strong>ƒê√£ giao cho:</strong>
                            <span th:text="${order.assignedStaff.fullName}">Staff Name</span>
                            <small class="d-block text-muted mt-1">
                                Giao l√∫c: <span
                                    th:text="${#temporals.format(order.assignedAt, 'dd/MM/yyyy HH:mm')}">-</span>
                            </small>
                        </div>

                        <!-- Form giao vi·ªác -->
                        <form th:action="@{/manager/requests/{id}/assign-staff(id=${order.id})}" method="post">
                            <div class="row align-items-end">
                                <div class="col-md-8 mb-2">
                                    <label class="form-label fw-bold">Ch·ªçn nh√¢n vi√™n:</label>
                                    <select name="staffId" class="form-select" required>
                                        <option value="">-- Ch·ªçn Staff --</option>
                                        <option th:each="s : ${staffs}" th:value="${s.id}"
                                            th:text="${s.fullName + ' (' + (s.location?.name ?: 'Ch∆∞a ph√¢n kho') + ')'}"
                                            th:selected="${order.assignedStaff != null && order.assignedStaff.id == s.id}">
                                            Staff
                                        </option>
                                    </select>
                                </div>
                                <div class="col-md-4 mb-2">
                                    <button type="submit" class="btn btn-warning w-100">
                                        <i class="fas fa-paper-plane me-1"></i>Giao vi·ªác
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
                <!-- Card: Ki·ªán h√†ng - Summary -->
                <div class="card shadow-sm mb-4">
                    <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
                        <h6 class="mb-0 fw-bold text-info">
                            <i class="fas fa-boxes me-2"></i>Ki·ªán h√†ng
                        </h6>
                        <a th:href="@{/manager/requests/{id}/parcels(id=${order.id})}"
                            class="btn btn-sm btn-outline-info">
                            <i class="fas fa-eye me-1"></i>Chi ti·∫øt
                        </a>
                    </div>
                    <div class="card-body py-3">
                        <div class="row text-center" th:if="${#lists.size(parcels) > 0}">
                            <div class="col-3">
                                <div class="p-2 rounded bg-light">
                                    <h4 class="mb-0 text-primary" th:text="${#lists.size(parcels)}">0</h4>
                                    <small class="text-muted">T·ªïng</small>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="p-2 rounded bg-success bg-opacity-10">
                                    <h4 class="mb-0 text-success"
                                        th:text="${#lists.size(parcels.?[status.name() == 'DELIVERED'])}">0</h4>
                                    <small class="text-muted">ƒê√£ giao</small>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="p-2 rounded bg-warning bg-opacity-10">
                                    <h4 class="mb-0 text-warning"
                                        th:text="${#lists.size(parcels.?[status.name() == 'IN_TRANSIT' or status.name() == 'OUT_FOR_DELIVERY'])}">
                                        0</h4>
                                    <small class="text-muted">ƒêang VC</small>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="p-2 rounded bg-secondary bg-opacity-10">
                                    <h4 class="mb-0 text-secondary"
                                        th:text="${#lists.size(parcels.?[status.name() != 'DELIVERED' and status.name() != 'IN_TRANSIT' and status.name() != 'OUT_FOR_DELIVERY'])}">
                                        0</h4>
                                    <small class="text-muted">C√≤n l·∫°i</small>
                                </div>
                            </div>
                        </div>
                        <div th:if="${#lists.size(parcels) == 0}" class="text-center text-muted py-2">
                            <i class="fas fa-inbox opacity-50 me-2"></i>Ch∆∞a c√≥ ki·ªán h√†ng
                        </div>
                    </div>
                </div>

                <!-- Card: Chuy·∫øn v·∫≠n chuy·ªÉn - Summary -->
                <div class="card shadow-sm mb-4">
                    <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
                        <h6 class="mb-0 fw-bold text-primary">
                            <i class="fas fa-truck me-2"></i>Chuy·∫øn v·∫≠n chuy·ªÉn
                        </h6>
                        <a th:href="@{/manager/requests/{id}/trips(id=${order.id})}"
                            class="btn btn-sm btn-outline-primary">
                            <i class="fas fa-eye me-1"></i>Chi ti·∫øt
                        </a>
                    </div>
                    <div class="card-body py-3">
                        <div class="row text-center" th:if="${#lists.size(trips) > 0}">
                            <div class="col-3">
                                <div class="p-2 rounded bg-light">
                                    <h4 class="mb-0 text-primary" th:text="${#lists.size(trips)}">0</h4>
                                    <small class="text-muted">T·ªïng</small>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="p-2 rounded bg-success bg-opacity-10">
                                    <h4 class="mb-0 text-success"
                                        th:text="${#lists.size(trips.?[status.name() == 'COMPLETED'])}">0</h4>
                                    <small class="text-muted">Ho√†n th√†nh</small>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="p-2 rounded bg-primary bg-opacity-10">
                                    <h4 class="mb-0 text-info"
                                        th:text="${#lists.size(trips.?[status.name() == 'IN_PROGRESS'])}">0</h4>
                                    <small class="text-muted">ƒêang ch·∫°y</small>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="p-2 rounded bg-secondary bg-opacity-10">
                                    <h4 class="mb-0 text-secondary"
                                        th:text="${#lists.size(trips.?[status.name() == 'CREATED'])}">0</h4>
                                    <small class="text-muted">Ch·ªù</small>
                                </div>
                            </div>
                        </div>
                        <div th:if="${#lists.size(trips) == 0}" class="text-center text-muted py-2">
                            <i class="fas fa-road opacity-50 me-2"></i>Ch∆∞a c√≥ chuy·∫øn n√†o
                        </div>
                    </div>
                </div>

                <!-- Card: Thanh to√°n - Summary -->
                <div class="card shadow-sm mb-4">
                    <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
                        <h6 class="mb-0 fw-bold text-success">
                            <i class="fas fa-money-bill me-2"></i>Thanh to√°n
                        </h6>
                        <a th:href="@{/manager/requests/{id}/payments(id=${order.id})}"
                            class="btn btn-sm btn-outline-success">
                            <i class="fas fa-eye me-1"></i>Chi ti·∫øt
                        </a>
                    </div>
                    <div class="card-body py-3">
                        <div class="row text-center" th:if="${#lists.size(payments) > 0}">
                            <div class="col-4">
                                <div class="p-2 rounded bg-primary bg-opacity-10">
                                    <h4 class="mb-0 text-primary"
                                        th:text="${#lists.size(payments.?[paymentType.name() == 'SHIPPING_FEE'])}">0
                                    </h4>
                                    <small class="text-muted">Ph√≠ ship</small>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="p-2 rounded bg-warning bg-opacity-10">
                                    <h4 class="mb-0 text-warning"
                                        th:text="${#lists.size(payments.?[paymentType.name() == 'COD'])}">0</h4>
                                    <small class="text-muted">COD</small>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="p-2 rounded bg-success bg-opacity-10">
                                    <h4 class="mb-0 text-success"
                                        th:text="${#lists.size(payments.?[status.name() == 'PAID'])}">0</h4>
                                    <small class="text-muted">ƒê√£ TT</small>
                                </div>
                            </div>
                        </div>
                        <!-- T·ªïng ti·ªÅn -->
                        <div th:if="${#lists.size(payments) > 0}" class="mt-3 text-center border-top pt-3">
                            <span class="text-muted">T·ªïng c·∫ßn thu:</span>
                            <span class="fw-bold text-primary fs-5"
                                th:text="${#numbers.formatDecimal(#aggregates.sum(payments.![expectedAmount ?: 0]), 0, 'COMMA', 0, 'POINT')} + '‚Ç´'">0‚Ç´</span>
                            <span class="mx-2">|</span>
                            <span class="text-muted">ƒê√£ nh·∫≠n:</span>
                            <span class="fw-bold text-success fs-5"
                                th:text="${#numbers.formatDecimal(#aggregates.sum(payments.![paidAmount ?: 0]), 0, 'COMMA', 0, 'POINT')} + '‚Ç´'">0‚Ç´</span>
                        </div>
                        <div th:if="${#lists.size(payments) == 0}" class="text-center text-muted py-2">
                            <i class="fas fa-wallet opacity-50 me-2"></i>Ch∆∞a c√≥ kho·∫£n thanh to√°n
                        </div>
                    </div>
                    <div class="card-footer bg-light">
                        <button class="btn btn-sm btn-outline-success w-100" data-bs-toggle="modal"
                            data-bs-target="#createPaymentModal">
                            <i class="fas fa-plus me-1"></i>T·∫°o Payment m·ªõi
                        </button>
                    </div>
                </div>
            </div>

            <!-- C·ªôt ph·∫£i: Form t·∫°o Trip -->
            <div class="col-lg-4">
                <div class="card shadow-sm mb-4 sticky-top" style="top: 80px;">
                    <div class="card-header bg-primary text-white py-3">
                        <h6 class="mb-0 fw-bold"><i class="fas fa-route me-2"></i>T·∫°o chuy·∫øn m·ªõi</h6>
                    </div>
                    <div class="card-body">
                        <form th:action="@{/manager/trips/create}" method="post">
                            <input type="hidden" name="requestId" th:value="${order.id}">

                            <div class="mb-3">
                                <label class="form-label fw-bold">Lo·∫°i chuy·∫øn</label>
                                <select name="tripType" class="form-select" required>
                                    <option value="PICKUP">üöö L·∫•y h√†ng (PICKUP)</option>
                                    <option value="TRANSFER">üîÑ Trung chuy·ªÉn (TRANSFER)</option>
                                    <option value="DELIVERY">üì¶ Giao h√†ng (DELIVERY)</option>
                                </select>
                            </div>

                            <div class="mb-3">
                                <label class="form-label fw-bold">T√†i x·∫ø</label>
                                <select name="shipperId" class="form-select" required>
                                    <option value="">-- Ch·ªçn t√†i x·∫ø --</option>
                                    <option th:each="s : ${shippers}" th:value="${s.id}"
                                        th:text="${s.fullName + (s.isAvailable ? ' ‚úÖ' : ' (B·∫≠n)')}"
                                        th:classappend="${s.isAvailable ? '' : 'text-muted'}">T√†i x·∫ø</option>
                                </select>
                            </div>

                            <div class="mb-3">
                                <label class="form-label">Xe (t√πy ch·ªçn)</label>
                                <select name="vehicleId" class="form-select">
                                    <option value="">-- Kh√¥ng ch·ªçn --</option>
                                    <option th:each="v : ${vehicles}" th:value="${v.id}"
                                        th:text="${v.licensePlate + ' (' + v.vehicleType + ')'}">Xe</option>
                                </select>
                            </div>

                            <div class="row">
                                <div class="col-6 mb-3">
                                    <label class="form-label fw-bold">ƒêi·ªÉm ƒëi</label>
                                    <select name="startLocationId" class="form-select" required>
                                        <option value="">Ch·ªçn...</option>
                                        <option th:each="loc : ${locations}" th:value="${loc.id}" th:text="${loc.name}">
                                            ƒê·ªãa ƒëi·ªÉm</option>
                                    </select>
                                </div>
                                <div class="col-6 mb-3">
                                    <label class="form-label fw-bold">ƒêi·ªÉm ƒë·∫øn</label>
                                    <select name="endLocationId" class="form-select" required>
                                        <option value="">Ch·ªçn...</option>
                                        <option th:each="loc : ${locations}" th:value="${loc.id}" th:text="${loc.name}">
                                            ƒê·ªãa ƒëi·ªÉm</option>
                                    </select>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label class="form-label">Ghi ch√∫</label>
                                <textarea name="note" class="form-control" rows="2" placeholder="Ghi ch√∫..."></textarea>
                            </div>

                            <button type="submit" class="btn btn-primary w-100">
                                <i class="fas fa-plus me-1"></i>T·∫°o chuy·∫øn
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal: T·∫°o Payment -->
        <div class="modal fade" id="createPaymentModal" tabindex="-1">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header bg-success text-white">
                        <h5 class="modal-title"><i class="fas fa-money-bill me-2"></i>T·∫°o Payment</h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                    </div>
                    <form th:action="@{/manager/payments/create}" method="post">
                        <div class="modal-body">
                            <input type="hidden" name="requestId" th:value="${order.id}">

                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label fw-bold">Lo·∫°i kho·∫£n ti·ªÅn</label>
                                    <select name="paymentType" class="form-select" required>
                                        <option value="SHIPPING_FEE">üíµ Ph√≠ v·∫≠n chuy·ªÉn</option>
                                        <option value="COD">üì¶ Thu h·ªô COD</option>
                                        <option value="DEPOSIT">üí∞ Ti·ªÅn c·ªçc</option>
                                    </select>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label fw-bold">S·ªë ti·ªÅn (VNƒê)</label>
                                    <input type="number" name="expectedAmount" class="form-control" required min="0"
                                        placeholder="500000">
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label fw-bold">Ph·∫°m vi thanh to√°n</label>
                                    <select name="paymentScope" id="paymentScopeSelect" class="form-select" required
                                        onchange="toggleTripSelect()">
                                        <option value="FULL_REQUEST">üìã To√†n b·ªô ƒë∆°n h√†ng</option>
                                        <option value="PER_TRIP">üöö Theo chuy·∫øn v·∫≠n chuy·ªÉn</option>
                                    </select>
                                </div>
                                <div class="col-md-6 mb-3" id="tripSelectContainer" style="display: none;">
                                    <label class="form-label fw-bold">Ch·ªçn chuy·∫øn</label>
                                    <select name="tripId" class="form-select">
                                        <option value="">-- Ch·ªçn chuy·∫øn --</option>
                                        <option th:each="t : ${trips}" th:value="${t.id}"
                                            th:text="'#' + ${t.id} + ' - ' + ${t.tripType.name()} + ' (' + ${t.status.name()} + ')'">
                                            Trip</option>
                                    </select>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label fw-bold">Ng∆∞·ªùi tr·∫£ ti·ªÅn</label>
                                    <select name="payerType" class="form-select" required>
                                        <option value="SENDER">üë§ Ng∆∞·ªùi g·ª≠i</option>
                                        <option value="RECEIVER">üì¨ Ng∆∞·ªùi nh·∫≠n</option>
                                        <option value="COMPANY">üè¢ C√¥ng ty</option>
                                    </select>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label fw-bold">Nh·∫≠n ti·ªÅn</label>
                                    <select name="receiverType" class="form-select" required>
                                        <option value="COMPANY">üè¢ C√¥ng ty</option>
                                        <option value="SENDER">üë§ Ng∆∞·ªùi g·ª≠i (ho√†n l·∫°i)</option>
                                    </select>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label class="form-label">M√¥ t·∫£</label>
                                <input type="text" name="description" class="form-control"
                                    placeholder="Ghi ch√∫ v·ªÅ kho·∫£n thanh to√°n">
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy</button>
                            <button type="submit" class="btn btn-success">T·∫°o Payment</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <script>
            function toggleTripSelect() {
                var scope = document.getElementById('paymentScopeSelect').value;
                var container = document.getElementById('tripSelectContainer');
                container.style.display = (scope === 'PER_TRIP') ? 'block' : 'none';
            }
        </script>

        <!-- Modal: C·∫≠p nh·∫≠t ƒë·ªãa ƒëi·ªÉm -->
        <div class="modal fade" id="updateLocationModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header bg-secondary text-white">
                        <h5 class="modal-title"><i class="fas fa-map-marker-alt me-2"></i>Thay ƒë·ªïi ƒë·ªãa ƒëi·ªÉm</h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                    </div>
                    <form th:action="@{/manager/requests/{id}/update-locations(id=${order.id})}" method="post">
                        <div class="modal-body">
                            <div class="mb-3">
                                <label class="form-label fw-bold"><i
                                        class="fas fa-map-marker-alt text-success me-1"></i>ƒêi·ªÉm l·∫•y h√†ng</label>
                                <select name="senderLocationId" class="form-select">
                                    <option value="">-- Kh√¥ng thay ƒë·ªïi --</option>
                                    <option th:each="loc : ${locations}" th:value="${loc.id}"
                                        th:text="${loc.name + ' - ' + (loc.addressText ?: '')}"
                                        th:selected="${order.senderLocation?.id == loc.id}">ƒê·ªãa ƒëi·ªÉm</option>
                                </select>
                            </div>

                            <div class="mb-3">
                                <label class="form-label fw-bold"><i
                                        class="fas fa-map-marker-alt text-danger me-1"></i>ƒêi·ªÉm giao h√†ng</label>
                                <select name="receiverLocationId" class="form-select">
                                    <option value="">-- Kh√¥ng thay ƒë·ªïi --</option>
                                    <option th:each="loc : ${locations}" th:value="${loc.id}"
                                        th:text="${loc.name + ' - ' + (loc.addressText ?: '')}"
                                        th:selected="${order.receiverLocation?.id == loc.id}">ƒê·ªãa ƒëi·ªÉm</option>
                                </select>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy</button>
                            <button type="submit" class="btn btn-primary">C·∫≠p nh·∫≠t</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Modal: T·∫°o ƒë·ªãa ƒëi·ªÉm m·ªõi -->
        <div class="modal fade" id="createLocationModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header bg-primary text-white">
                        <h5 class="modal-title"><i class="fas fa-plus me-2"></i>T·∫°o ƒë·ªãa ƒëi·ªÉm m·ªõi</h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                    </div>
                    <form th:action="@{/manager/locations/create}" method="post">
                        <input type="hidden" name="returnToRequestId" th:value="${order.id}">
                        <div class="modal-body">
                            <div class="mb-3">
                                <label class="form-label fw-bold">T√™n ƒë·ªãa ƒëi·ªÉm</label>
                                <input type="text" name="name" class="form-control" required
                                    placeholder="V√≠ d·ª•: Nh√† anh Nam - Q7">
                            </div>

                            <div class="mb-3">
                                <label class="form-label fw-bold">ƒê·ªãa ch·ªâ ƒë·∫ßy ƒë·ªß</label>
                                <input type="text" name="addressText" class="form-control" required
                                    placeholder="V√≠ d·ª•: 123 Nguy·ªÖn VƒÉn Linh, P.T√¢n Ph√∫, Q7, TP.HCM">
                            </div>

                            <div class="mb-3">
                                <label class="form-label fw-bold">Lo·∫°i ƒë·ªãa ƒëi·ªÉm</label>
                                <select name="locationType" class="form-select" required>
                                    <option value="SENDER">üì§ ƒêi·ªÉm g·ª≠i (SENDER)</option>
                                    <option value="RECEIVER">üì• ƒêi·ªÉm nh·∫≠n (RECEIVER)</option>
                                    <option value="WAREHOUSE">üè¢ Kho (WAREHOUSE)</option>
                                </select>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy</button>
                            <button type="submit" class="btn btn-primary">T·∫°o ƒë·ªãa ƒëi·ªÉm</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

</body>

</html>